org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.editorstate","ver":"1.0","shortId":"editorstate","author":"Sunil A S","title":"Editor State","description":"","publishedDate":"","editor":{"main":"editor/plugin.js"}},org.ekstep.contenteditor.basePlugin.extend({extPluginsList:[],state:{plugin:{},stage:{},sidebar:{}},initialize:function(){var i=this;ecEditor.addEventListener("content:before:save",function(){ecEditor.dispatchEvent(i.manifest.id+":state",i.getEditorState(),i)},this),ecEditor.addEventListener("content:load:complete",this.setEditorState,this),ecEditor.addEventListener("plugin:load",function(t,e){i.extPluginsList.push({plugin:e.plugin,version:e.version})})},getEditorState:function(){return this.state.plugin={noOfExtPlugins:this.extPluginsList.length,extPlugins:this.extPluginsList},this.state.stage={noOfStages:ecEditor.getAllStages().length,currentStage:ecEditor.getCurrentStage().id,selectedPluginObject:ecEditor.getCurrentObject().id||void 0},this.state.sidebar={selectedMenu:ecEditor.getCurrentSidebarMenu()},this.state},setEditorState:function(){this.setStageState(),this.setPluginState(),this.setSidebarState()},_getStateFromService:function(){if(ecEditor.getService(ServiceConstants.CONTENT_SERVICE).getContentMeta(ecEditor.getContext("contentId")).editorState)return JSON.parse(ecEditor.getService(ServiceConstants.CONTENT_SERVICE).getContentMeta(ecEditor.getContext("contentId")).editorState)},setStageState:function(){var e=this._getStateFromService();e&&e.stage?(ecEditor.dispatchEvent("stage:select",{stageId:e.stage.currentStage}),e.stage.selectedPluginObject&&_.forEach(ecEditor.getStage(e.stage.currentStage).children,function(t){t.id===e.stage.selectedPluginObject&&ecEditor.getCurrentStage().canvas.setActiveObject(t.editorObj)})):ecEditor.dispatchEvent("stage:select",{stageId:ecEditor.getAllStages()[0].id})},setPluginState:function(){var t=this._getStateFromService();t&&t.plugin&&t.plugin.extPlugins.forEach(function(t){ecEditor.loadPlugin(t.plugin,t.version)})},setSidebarState:function(){var t=this._getStateFromService();t&&t.sidebar?ecEditor.showSidebarMenu(t.sidebar.selectedMenu):ecEditor.showSidebarMenu("settings")}}))